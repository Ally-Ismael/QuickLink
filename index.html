<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickLink AI - Multi-Page Demo</title>
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="theme-color" content="#764ba2">
    <link rel="stylesheet" href="./CSS/styling.css" type="text/css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>QuickLink AI</h1>
                    <p>USSD Voice Assistant</p>
                </div>
                <div class="phone-icon">üìû</div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress">
            <div class="progress-text">Step <span id="step-number">1</span> of 8</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Step 1: Dial -->
            <div id="page-dial" class="page active">
                <div class="text-center mb-6">
                    <div class="mb-6">
                        <div class="phone-icon text-4xl mb-4">üìû</div>
                        <h2 class="text-2xl font-bold mb-2">QuickLink AI Access</h2>
                        <p class="text-gray-600">Dial *542# to start</p>
                    </div>
                    <div class="phone-display">
                        <div class="font-mono text-lg">*542#</div>
                    </div>
                    <button class="btn" onclick="nextPage('language')">
                        Connect ‚Üí
                    </button>
                    <button class="btn" style="margin-top: 8px; background: #10b981;" onclick="quickDemo()">
                        Skip setup ‚Üí
                    </button>
                </div>
            </div>

            <!-- Step 2: Language Selection -->
            <div id="page-language" class="page">
                <h2 class="text-xl font-bold mb-4">Select Your Language</h2>
                <div class="space-y-3 mb-6">
                    <div class="language-option" onclick="selectLanguage('EN')">
                        <span class="option-icon">üá∫üá∏</span>
                        <span class="option-name">English</span>
                        <span class="option-check" id="check-EN"></span>
                    </div>
                    <div class="language-option" onclick="selectLanguage('AF')">
                        <span class="option-icon">üáøüá¶</span>
                        <span class="option-name">Afrikaans</span>
                        <span class="option-check" id="check-AF"></span>
                    </div>
                    <div class="language-option" onclick="selectLanguage('OW')">
                        <span class="option-icon">üá≥üá¶</span>
                        <span class="option-name">Oshiwambo</span>
                        <span class="option-check" id="check-OW"></span>
                    </div>
                </div>
                <button class="btn" id="language-continue" disabled onclick="nextPage('phoneType')">
                    Continue
                </button>
            </div>

            <!-- Step 3: Phone Type -->
            <div id="page-phoneType" class="page">
                <h2 class="text-xl font-bold mb-4">Select Your Phone Type</h2>
                <div class="space-y-3 mb-6">
                    <div class="phone-option" onclick="selectPhoneType('basic')">
                        <span class="option-icon">üìû</span>
                        <div class="option-name">
                            <div class="font-medium">Basic Phone (Voice Only)</div>
                            <div class="text-sm text-gray-600">Voice interaction only</div>
                        </div>
                        <span class="option-check" id="check-phone-basic"></span>
                    </div>
                    <div class="phone-option" onclick="selectPhoneType('smart')">
                        <span class="option-icon">üì±</span>
                        <div class="option-name">
                            <div class="font-medium">Smartphone (Text + Voice)</div>
                            <div class="text-sm text-gray-600">Text and voice options</div>
                        </div>
                        <span class="option-check" id="check-phone-smart"></span>
                    </div>
                </div>
                <button class="btn" id="phone-continue" disabled onclick="nextPage('userCheck')">
                    Continue
                </button>
            </div>

            <!-- Step 4: User Check -->
            <div id="page-userCheck" class="page">
                <div class="text-center">
                    <div class="phone-icon text-4xl text-blue-600 mb-4">üë§</div>
                    <h2 class="text-xl font-bold mb-4">User Account Check</h2>
                    <p class="text-gray-600 mb-6">Checking if you're a new or returning user...</p>
                    <div class="space-y-3 mb-6">
                        <div class="user-option" onclick="selectUserType(true)">
                            New User (First time using QuickLink AI)
                        </div>
                        <div class="user-option" onclick="selectUserType(false)">
                            Returning User (I have an account)
                        </div>
                    </div>
                    <button class="btn" onclick="handleUserCheck()">
                        Continue
                    </button>
                </div>
            </div>

            <!-- Step 5: Registration -->
            <div id="page-registration" class="page">
                <h2 class="text-xl font-bold mb-4">Welcome! Let's Set Up Your Account</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        What's your name?
                    </label>
                    <input
                        type="text"
                        id="user-name"
                        placeholder="Enter your full name"
                        class="input-field"
                        oninput="checkRegistration()"
                    />
                </div>
                <div class="feature-box">
                    <h3 class="feature-title">Account Features:</h3>
                    <ul class="feature-list">
                        <li>90-day conversation history</li>
                        <li>Personalized learning recommendations</li>
                        <li>Multiple language support</li>
                        <li>Progress tracking</li>
                    </ul>
                </div>
                <button class="btn" id="register-btn" disabled onclick="nextPage('mainMenu')">
                    Create Account
                </button>
            </div>

            <!-- Step 6: Main Menu -->
            <div id="page-mainMenu" class="page">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h2 class="text-xl font-bold text-blue-800 mb-2">
                        Welcome<span id="user-greeting"></span>! üëã
                    </h2>
                    <div class="offline-indicator">
                        <span class="offline-icon">üìµ</span>
                        No internet required ‚Ä¢ <span id="selected-language">English</span>
                    </div>
                </div>
                
                <h3 class="text-lg font-semibold mb-4">How can I help you learn today?</h3>
                
            <div class="menu-grid">
                <a href="subject-tutoring.html" class="menu-button menu-button-1">
                    üìö Subject Tutoring
                </a>
                <a href="exam-preparation.html" class="menu-button menu-button-2">
                    üéØ Exam Preparation
                </a>
                <a href="career-guidance.html" class="menu-button menu-button-3">
                    üíº Career Guidance
                </a>
                <a href="language-learning.html" class="menu-button menu-button-4">
                    üó£Ô∏è Language Learning
                </a>
            </div>

                
                <button class="btn" onclick="nextPage('query')">
                    Ask a Question ‚Üí
                </button>
            </div>

            <!-- Step 7: Query -->
            <div id="page-query" class="page">
                <h2 class="text-xl font-bold mb-4">Ask a Question</h2>
                
                <div id="voice-warning" class="voice-warning">
                    <div class="voice-warning-header">
                        <span class="mr-2">üîä</span>
                        Voice Mode Active
                    </div>
                    <p class="voice-warning-text">Speak your question clearly after the beep</p>
                </div>
                
                <div class="input-mode">
                    <div class="input-mode-btn" id="mode-type" onclick="setInputMode('type')">
                        <div class="input-mode-icon">‚å®Ô∏è</div>
                        <div class="input-mode-text">Text</div>
                    </div>
                    <div class="input-mode-btn active" id="mode-voice" onclick="setInputMode('voice')">
                        <div class="input-mode-icon">üé§</div>
                        <div class="input-mode-text">Voice</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <span id="input-label">Select a sample question...</span>
                    </label>
                    
                    <div id="text-input" class="hidden">
                        <textarea
                            id="custom-query"
                            placeholder="Type your question:"
                            rows="3"
                            class="input-field"
                            oninput="checkQuery()"
                        ></textarea>
                    </div>
                    
                    <div id="voice-input">
                        <select
                            id="sample-queries"
                            class="sample-queries"
                            onchange="checkQuery()"
                        >
                            <option value="">Select a sample question...</option>
                            <option value="What is photosynthesis?">What is photosynthesis?</option>
                            <option value="How do I calculate the area of a circle?">How do I calculate the area of a circle?</option>
                            <option value="What career options are available in engineering?">What career options are available in engineering?</option>
                            <option value="Explain Newton's first law of motion">Explain Newton's first law of motion</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" id="submit-query" disabled onclick="nextPage('response')">
                    Submit Question
                </button>
            </div>

            <!-- Step 8: Response -->
            <div id="page-response" class="page">
                <h2 class="text-xl font-bold mb-4">AI Response</h2>
                
                <div class="query-history">
                    <div class="text-sm text-gray-600 mb-2">Your Question:</div>
                    <div class="query-text" id="displayed-query"></div>
                </div>
                
                <div id="typing-indicator" class="typing-indicator">
                    <div class="spinner"></div>
                    <span class="typing-text">AI is thinking...</span>
                </div>
                
                <div id="ai-response" class="response-box hidden">
                    <div class="response-header">
                        <span class="mr-2">üîä</span>
                        AI Response:
                    </div>
                    <p class="response-text" id="response-text"></p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="nextPage('mainMenu')">
                        Ask Another Question
                    </button>
                    <button class="btn btn-secondary" onclick="resetDemo()">
                        Start Over
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            Demo for NVP Presentation ‚Ä¢ No Internet Required ‚Ä¢ Questions: <span id="question-count">0</span>
            <div id="offline-toast" class="offline-toast hidden">Offline ready ‚úì</div>
        </div>
    </div>

    <script>
        // Demo state
        let currentState = {
            currentPage: 'dial',
            selectedLanguage: 'EN',
            phoneType: 'smart',
            isNewUser: true,
            userName: '',
            currentQuery: '',
            customQuery: '',
            inputMode: 'voice',
            ttsEnabled: false
        };
        
        const pages = ['dial', 'language', 'phoneType', 'userCheck', 'registration', 'mainMenu', 'query', 'response'];
        
        // Sample responses
        const responses = {
            "What is photosynthesis?": "Photosynthesis is the process by which plants use sunlight, water, and carbon dioxide to create oxygen and energy in the form of sugar. This happens in the chloroplasts of plant cells.",
            "How do I calculate the area of a circle?": "To calculate the area of a circle, use the formula A = œÄ √ó r¬≤, where 'r' is the radius. For example, if the radius is 5 units, the area would be œÄ √ó 5¬≤ = 25œÄ square units.",
            "What career options are available in engineering?": "Engineering offers many career paths including Civil Engineering (buildings, roads), Electrical Engineering (power systems), Mechanical Engineering (machines), and Software Engineering (computer programs).",
            "Explain Newton's first law of motion": "Newton's First Law states that an object at rest stays at rest, and an object in motion stays in motion, unless acted upon by an external force. This is also called the law of inertia."
        };
        
        // Navigation functions
        function nextPage(page) {
            try { if (window.speechSynthesis) window.speechSynthesis.cancel(); } catch(e) {}
            const currentIndex = pages.indexOf(currentState.currentPage);
            const nextIndex = pages.indexOf(page);
            
            if (nextIndex !== -1) {
                // Hide current page
                document.getElementById(`page-${currentState.currentPage}`).classList.remove('active');
                
                // Show next page
                currentState.currentPage = page;
                document.getElementById(`page-${page}`).classList.add('active');
                
                // Update progress
                updateProgress(nextIndex + 1);
                
                // Handle specific page transitions
                handlePageTransition(page);
            }
        }
        
        function updateProgress(step) {
            document.getElementById('step-number').textContent = step;
            document.getElementById('progress-fill').style.width = `${(step / 8) * 100}%`;
        }
        
        function handlePageTransition(page) {
            switch(page) {
                case 'mainMenu':
                    updateMainMenu();
                    break;
                case 'response':
                    showResponse();
                    break;
            }
        }
        
        // State management functions
        function selectLanguage(lang) {
            currentState.selectedLanguage = lang;
            document.querySelectorAll('.language-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            document.querySelectorAll('.option-check').forEach(el => {
                el.textContent = '';
            });
            document.getElementById(`check-${lang}`).textContent = '‚úì';
            document.getElementById('language-continue').disabled = false;
        }
        
        function selectPhoneType(type) {
            currentState.phoneType = type;
            document.querySelectorAll('.phone-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            document.querySelectorAll('.option-check').forEach(el => {
                el.textContent = '';
            });
            document.getElementById(`check-phone-${type}`).textContent = '‚úì';
            document.getElementById('phone-continue').disabled = false;
            
            // Update voice warning visibility
            const voiceWarning = document.getElementById('voice-warning');
            if (type === 'basic') {
                voiceWarning.classList.remove('hidden');
            } else {
                voiceWarning.classList.add('hidden');
            }
        }
        
        function selectUserType(isNew) {
            currentState.isNewUser = isNew;
            document.querySelectorAll('.user-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }
        
        function handleUserCheck() {
            if (currentState.isNewUser) {
                nextPage('registration');
            } else {
                nextPage('mainMenu');
            }
        }
        
        function checkRegistration() {
            const name = document.getElementById('user-name').value.trim();
            currentState.userName = name;
            document.getElementById('register-btn').disabled = !name;
        }
        
        function updateMainMenu() {
            const greeting = document.getElementById('user-greeting');
            if (currentState.userName) {
                greeting.textContent = `, ${currentState.userName}`;
            } else {
                greeting.textContent = '';
            }
            
            // Update language display
            const langNames = {
                'EN': 'English',
                'AF': 'Afrikaans',
                'OW': 'Oshiwambo'
            };
            document.getElementById('selected-language').textContent = 
                langNames[currentState.selectedLanguage] || 'English';
        }
        
        function setInputMode(mode) {
            currentState.inputMode = mode;
            
            // Update UI
            document.getElementById('mode-type').classList.toggle('active', mode === 'type');
            document.getElementById('mode-voice').classList.toggle('active', mode === 'voice');
            
            // Show/hide inputs
            document.getElementById('text-input').classList.toggle('hidden', mode !== 'type');
            document.getElementById('voice-input').classList.toggle('hidden', mode !== 'voice');
            
            // Update label
            const label = document.getElementById('input-label');
            if (mode === 'type') {
                label.textContent = 'Type your question:';
            } else {
                label.textContent = currentState.phoneType === 'basic' ? 'Simulated Voice Input:' : 'Select a sample question...';
            }
            
            checkQuery();
            if (mode === 'voice') { playBeep(); }
        }
        
        function checkQuery() {
            const queryToCheck = currentState.inputMode === 'type' ? 
                document.getElementById('custom-query').value : 
                document.getElementById('sample-queries').value;
            document.getElementById('submit-query').disabled = !queryToCheck;
        }
        
        function showResponse() {
            const queryToDisplay = currentState.inputMode === 'type' ? 
                document.getElementById('custom-query').value : 
                document.getElementById('sample-queries').value;
            
            document.getElementById('displayed-query').textContent = queryToDisplay;
            
            // Show typing indicator
            document.getElementById('typing-indicator').classList.remove('hidden');
            document.getElementById('ai-response').classList.add('hidden');
            
            // Telemetry: increment local question count
            incrementQuestionCount();
            
            // Generate response after delay
            setTimeout(() => {
                const response = responses[queryToDisplay] || 
                    "Thank you for your question. I'm here to help with educational topics. Could you please rephrase your question?";
                document.getElementById('response-text').textContent = response;
                document.getElementById('typing-indicator').classList.add('hidden');
                document.getElementById('ai-response').classList.remove('hidden');
                
                // Optional TTS
                if (currentState.ttsEnabled) {
                    speakText(response);
                }
            }, 2000);
        }
        
        function resetDemo() {
            currentState = {
                currentPage: 'dial',
                selectedLanguage: 'EN',
                phoneType: 'smart',
                isNewUser: true,
                userName: '',
                currentQuery: '',
                customQuery: '',
                inputMode: 'voice',
                ttsEnabled: false
            };
            
            // Reset UI
            document.querySelectorAll('.language-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('.phone-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('.user-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('.option-check').forEach(el => {
                el.textContent = '';
            });
            document.getElementById('user-name').value = '';
            document.getElementById('sample-queries').value = '';
            document.getElementById('custom-query').value = '';
            document.getElementById('language-continue').disabled = true;
            document.getElementById('phone-continue').disabled = true;
            document.getElementById('register-btn').disabled = true;
            document.getElementById('submit-query').disabled = true;
            
            // Go back to dial page
            pages.forEach(page => {
                document.getElementById(`page-${page}`).classList.remove('active');
            });
            document.getElementById('page-dial').classList.add('active');
            updateProgress(1);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress(1);
            // Load and show question count
            const savedCount = parseInt(localStorage.getItem('ql_question_count') || '0', 10);
            const qc = document.getElementById('question-count');
            if (qc) qc.textContent = savedCount;
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js').then((reg) => {
                    const showReady = () => {
                        const toast = document.getElementById('offline-toast');
                        if (!toast) return;
                        toast.classList.remove('hidden');
                        setTimeout(() => toast.classList.add('hidden'), 2500);
                    };
                    if (reg.installing) {
                        reg.installing.addEventListener('statechange', (e) => {
                            if (e.target.state === 'activated') showReady();
                        });
                    } else if (reg.active) {
                        showReady();
                    }
                }).catch(() => {});
            }
        });
        
        // Quick demo path: set defaults and jump to query
        function quickDemo() {
            currentState.selectedLanguage = 'EN';
            currentState.phoneType = 'smart';
            currentState.isNewUser = false;
            currentState.inputMode = 'voice';
            try { document.getElementById('voice-warning').classList.add('hidden'); } catch(e) {}
            nextPage('query');
        }
        
        // Web Speech API TTS toggle and speak
        function toggleTTS(enabled) {
            currentState.ttsEnabled = enabled;
            try { if (!enabled && window.speechSynthesis) window.speechSynthesis.cancel(); } catch(e) {}
        }
        
        function speakText(text) {
            try {
                if (!('speechSynthesis' in window)) return;
                const utter = new SpeechSynthesisUtterance(text);
                const langMap = { EN: 'en-US', AF: 'af-ZA', OW: 'en-US' };
                utter.lang = langMap[currentState.selectedLanguage] || 'en-US';
                window.speechSynthesis.speak(utter);
            } catch (e) {}
        }
        
        // Simple beep using Web Audio API
        let audioCtx = null;
        function playBeep(frequency = 880, durationMs = 120) {
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                oscillator.connect(gain);
                gain.connect(audioCtx.destination);
                oscillator.frequency.value = frequency;
                gain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.01);
                oscillator.start();
                gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + durationMs / 1000);
                oscillator.stop(audioCtx.currentTime + durationMs / 1000 + 0.02);
            } catch (e) {}
        }
        
        // Local telemetry helpers
        function incrementQuestionCount() {
            try {
                const key = 'ql_question_count';
                const next = (parseInt(localStorage.getItem(key) || '0', 10) + 1);
                localStorage.setItem(key, String(next));
                const qc = document.getElementById('question-count');
                if (qc) qc.textContent = next;
            } catch (e) {}
        }
    </script>
</body>
</html>