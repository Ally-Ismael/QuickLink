import React, { useState, useEffect } from 'react';
import { Phone, Volume2, Type, User, ArrowRight, Wifi, WifiOff } from 'lucide-react';

const QuickLinkAIDemo = () => {
  const [currentStep, setCurrentStep] = useState('dial');
  const [selectedLanguage, setSelectedLanguage] = useState('');
  const [phoneType, setPhoneType] = useState('');
  const [userName, setUserName] = useState('');
  const [isNewUser, setIsNewUser] = useState(true);
  const [currentQuery, setCurrentQuery] = useState('');
  const [customQuery, setCustomQuery] = useState('');
  const [inputMode, setInputMode] = useState('select'); // 'select' or 'type'
  const [aiResponse, setAiResponse] = useState('');
  const [showTyping, setShowTyping] = useState(false);

  // Language translations
  const translations = {
    EN: {
      welcome: "Welcome",
      selectLanguage: "Select Your Language",
      selectPhone: "Select Your Phone Type",
      userCheck: "User Account Check",
      newUser: "New User (First time using QuickLink AI)",
      returningUser: "Returning User (I have an account)",
      whatsYourName: "What's your name?",
      enterName: "Enter your full name",
      accountFeatures: "Account Features:",
      conversationHistory: "90-day conversation history",
      personalizedLearning: "Personalized learning recommendations",
      multiLanguage: "Multiple language support",
      progressTracking: "Progress tracking",
      createAccount: "Create Account",
      howCanIHelp: "How can I help you learn today?",
      subjectTutoring: "Subject Tutoring",
      examPrep: "Exam Preparation",
      careerGuidance: "Career Guidance",
      languageLearning: "Language Learning",
      askQuestion: "Ask a Question",
      yourQuestion: "Your Question:",
      aiResponse: "AI Response:",
      askAnother: "Ask Another Question",
      startOver: "Start Over",
      continue: "Continue",
      submitQuestion: "Submit Question",
      voiceModeActive: "Voice Mode Active",
      speakClearly: "Speak your question clearly after the beep",
      typeQuestion: "Type your question:",
      selectSample: "Select a sample question...",
      aiThinking: "AI is thinking...",
      noInternetRequired: "No internet required"
    },
    AF: {
      welcome: "Welkom",
      selectLanguage: "Kies Jou Taal",
      selectPhone: "Kies Jou Foon Tipe",
      userCheck: "Gebruiker Rekening Kontrole",
      newUser: "Nuwe Gebruiker (Eerste keer QuickLink AI gebruik)",
      returningUser: "Terugkerende Gebruiker (Ek het 'n rekening)",
      whatsYourName: "Wat is jou naam?",
      enterName: "Voer jou volledige naam in",
      accountFeatures: "Rekening Kenmerke:",
      conversationHistory: "90-dag gespreksgeskiedenis",
      personalizedLearning: "Gepersonaliseerde leer aanbevelings",
      multiLanguage: "Veelvuldige taal ondersteuning",
      progressTracking: "Vordering opsporing",
      createAccount: "Skep Rekening",
      howCanIHelp: "Hoe kan ek jou vandag help leer?",
      subjectTutoring: "Vak Tutoring",
      examPrep: "Eksamen Voorbereiding",
      careerGuidance: "Loopbaan Leiding",
      languageLearning: "Taal Leer",
      askQuestion: "Vra 'n Vraag",
      yourQuestion: "Jou Vraag:",
      aiResponse: "AI Antwoord:",
      askAnother: "Vra Nog 'n Vraag",
      startOver: "Begin Weer",
      continue: "Gaan Voort",
      submitQuestion: "Dien Vraag In",
      voiceModeActive: "Stem Modus Aktief",
      speakClearly: "Praat jou vraag duidelik na die piep",
      typeQuestion: "Tik jou vraag:",
      selectSample: "Kies 'n voorbeeldvraag...",
      aiThinking: "AI dink...",
      noInternetRequired: "Geen internet benodig nie"
    },
    OW: {
      welcome: "Welcome",
      selectLanguage: "Select Your Language",
      selectPhone: "Select Your Phone Type",
      userCheck: "User Account Check",
      newUser: "New User (First time using QuickLink AI)",
      returningUser: "Returning User (I have an account)",
      whatsYourName: "What's your name?",
      enterName: "Enter your full name",
      accountFeatures: "Account Features:",
      conversationHistory: "90-day conversation history",
      personalizedLearning: "Personalized learning recommendations",
      multiLanguage: "Multiple language support",
      progressTracking: "Progress tracking",
      createAccount: "Create Account",
      howCanIHelp: "How can I help you learn today?",
      subjectTutoring: "Subject Tutoring",
      examPrep: "Exam Preparation",
      careerGuidance: "Career Guidance",
      languageLearning: "Language Learning",
      askQuestion: "Ask a Question",
      yourQuestion: "Your Question:",
      aiResponse: "AI Response:",
      askAnother: "Ask Another Question",
      startOver: "Start Over",
      continue: "Continue",
      submitQuestion: "Submit Question",
      voiceModeActive: "Voice Mode Active",
      speakClearly: "Speak your question clearly after the beep",
      typeQuestion: "Type your question:",
      selectSample: "Select a sample question...",
      aiThinking: "AI is thinking...",
      noInternetRequired: "No internet required"
    }
  };

  const t = (key) => translations[selectedLanguage]?.[key] || translations.EN[key];

  const languages = [
    { code: 'EN', name: 'English', flag: 'üá∫üá∏' },
    { code: 'AF', name: 'Afrikaans', flag: 'üáøüá¶' },
    { code: 'OW', name: 'Oshiwambo', flag: 'üá≥üá¶' }
  ];

  const phoneTypes = [
    { type: 'basic', name: 'Basic Phone (Voice Only)', icon: 'üìû' },
    { type: 'smart', name: 'Smartphone (Text + Voice)', icon: 'üì±' }
  ];

  const sampleQueries = [
    "What is photosynthesis?",
    "How do I calculate the area of a circle?",
    "What career options are available in engineering?",
    "Explain Newton's first law of motion"
  ];

  const generateAIResponse = (query) => {
    const responses = {
      "What is photosynthesis?": "Photosynthesis is the process by which plants use sunlight, water, and carbon dioxide to create oxygen and energy in the form of sugar. This happens in the chloroplasts of plant cells.",
      "How do I calculate the area of a circle?": "To calculate the area of a circle, use the formula A = œÄ √ó r¬≤, where 'r' is the radius. For example, if the radius is 5 units, the area would be œÄ √ó 5¬≤ = 25œÄ square units.",
      "What career options are available in engineering?": "Engineering offers many career paths including Civil Engineering (buildings, roads), Electrical Engineering (power systems), Mechanical Engineering (machines), and Software Engineering (computer programs).",
      "Explain Newton's first law of motion": "Newton's First Law states that an object at rest stays at rest, and an object in motion stays in motion, unless acted upon by an external force. This is also called the law of inertia."
    };
    return responses[query] || "Thank you for your question. I'm here to help with educational topics. Could you please rephrase your question?";
  };

  const handleNext = () => {
    switch(currentStep) {
      case 'dial':
        setCurrentStep('language');
        break;
      case 'language':
        setCurrentStep('phoneType');
        break;
      case 'phoneType':
        setCurrentStep('userCheck');
        break;
      case 'userCheck':
        if (isNewUser) {
          setCurrentStep('registration');
        } else {
          setCurrentStep('mainMenu');
        }
        break;
      case 'registration':
        setCurrentStep('mainMenu');
        break;
      case 'mainMenu':
        setCurrentStep('query');
        break;
      case 'query':
        setShowTyping(true);
        const queryToProcess = inputMode === 'type' ? customQuery : currentQuery;
        setTimeout(() => {
          setAiResponse(generateAIResponse(queryToProcess));
          setShowTyping(false);
          setCurrentStep('response');
        }, 2000);
        break;
      case 'response':
        setCurrentStep('mainMenu');
        setCurrentQuery('');
        setCustomQuery('');
        setInputMode('select');
        setAiResponse('');
        break;
    }
  };

  const resetDemo = () => {
    setCurrentStep('dial');
    setSelectedLanguage('');
    setPhoneType('');
    setUserName('');
    setIsNewUser(true);
    setCurrentQuery('');
    setCustomQuery('');
    setInputMode('select');
    setAiResponse('');
    setShowTyping(false);
  };

  const renderStep = () => {
    switch(currentStep) {
      case 'dial':
        return (
          <div className="text-center">
            <div className="mb-6">
              <Phone className="w-16 h-16 mx-auto text-blue-600 mb-4" />
              <h2 className="text-2xl font-bold mb-2">QuickLink AI Access</h2>
              <p className="text-gray-600">Dial *542# to start</p>
            </div>
            <div className="bg-gray-100 rounded-lg p-4 mb-6">
              <div className="font-mono text-lg">*542#</div>
            </div>
            <button 
              onClick={handleNext}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center mx-auto"
            >
              Connect <ArrowRight className="ml-2 w-4 h-4" />
            </button>
          </div>
        );

      case 'language':
        return (
          <div>
            <h2 className="text-xl font-bold mb-4">{t('selectLanguage')}</h2>
            <div className="space-y-3 mb-6">
              {languages.map((lang) => (
                <button
                  key={lang.code}
                  onClick={() => setSelectedLanguage(lang.code)}
                  className={`w-full p-3 rounded-lg border text-left flex items-center ${
                    selectedLanguage === lang.code 
                      ? 'border-blue-500 bg-blue-50' 
                      : 'border-gray-300 hover:border-gray-400'
                  }`}
                >
                  <span className="text-2xl mr-3">{lang.flag}</span>
                  <span>{lang.name}</span>
                  {selectedLanguage === lang.code && (
                    <span className="ml-auto text-blue-600">‚úì</span>
                  )}
                </button>
              ))}
            </div>
            <button 
              onClick={handleNext}
              disabled={!selectedLanguage}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
            >
              {t('continue')}
            </button>
          </div>
        );

      case 'phoneType':
        return (
          <div>
            <h2 className="text-xl font-bold mb-4">{t('selectPhone')}</h2>
            <div className="space-y-3 mb-6">
              {phoneTypes.map((phone) => (
                <button
                  key={phone.type}
                  onClick={() => setPhoneType(phone.type)}
                  className={`w-full p-4 rounded-lg border text-left flex items-center ${
                    phoneType === phone.type 
                      ? 'border-blue-500 bg-blue-50' 
                      : 'border-gray-300 hover:border-gray-400'
                  }`}
                >
                  <span className="text-2xl mr-3">{phone.icon}</span>
                  <div>
                    <div className="font-medium">{phone.name}</div>
                    <div className="text-sm text-gray-600">
                      {phone.type === 'basic' ? 'Voice interaction only' : 'Text and voice options'}
                    </div>
                  </div>
                  {phoneType === phone.type && (
                    <span className="ml-auto text-blue-600">‚úì</span>
                  )}
                </button>
              ))}
            </div>
            <button 
              onClick={handleNext}
              disabled={!phoneType}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
            >
              {t('continue')}
            </button>
          </div>
        );

      case 'userCheck':
        return (
          <div className="text-center">
            <User className="w-16 h-16 mx-auto text-blue-600 mb-4" />
            <h2 className="text-xl font-bold mb-4">{t('userCheck')}</h2>
            <p className="text-gray-600 mb-6">Checking if you're a new or returning user...</p>
            <div className="space-y-3 mb-6">
              <button
                onClick={() => setIsNewUser(true)}
                className={`w-full p-3 rounded-lg border ${
                  isNewUser ? 'border-blue-500 bg-blue-50' : 'border-gray-300'
                }`}
              >
                {t('newUser')}
              </button>
              <button
                onClick={() => setIsNewUser(false)}
                className={`w-full p-3 rounded-lg border ${
                  !isNewUser ? 'border-blue-500 bg-blue-50' : 'border-gray-300'
                }`}
              >
                {t('returningUser')}
              </button>
            </div>
            <button 
              onClick={handleNext}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
            >
              {t('continue')}
            </button>
          </div>
        );

      case 'registration':
        return (
          <div>
            <h2 className="text-xl font-bold mb-4">{t('welcome')}! Let's Set Up Your Account</h2>
            <div className="mb-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                {t('whatsYourName')}
              </label>
              <input
                type="text"
                value={userName}
                onChange={(e) => setUserName(e.target.value)}
                placeholder={t('enterName')}
                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              />
            </div>
            <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
              <h3 className="font-medium text-green-800 mb-2">{t('accountFeatures')}</h3>
              <ul className="text-sm text-green-700 space-y-1">
                <li>‚Ä¢ {t('conversationHistory')}</li>
                <li>‚Ä¢ {t('personalizedLearning')}</li>
                <li>‚Ä¢ {t('multiLanguage')}</li>
                <li>‚Ä¢ {t('progressTracking')}</li>
              </ul>
            </div>
            <button 
              onClick={handleNext}
              disabled={!userName.trim()}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
            >
              {t('createAccount')}
            </button>
          </div>
        );

      case 'mainMenu':
        return (
          <div>
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <h2 className="text-xl font-bold text-blue-800 mb-2">
                {t('welcome')}{userName ? `, ${userName}` : ''}! üëã
              </h2>
              <div class="flex items-center text-sm text-blue-700">
                <WifiOff className="w-4 h-4 mr-2" />
                {t('noInternetRequired')} ‚Ä¢ {languages.find(l => l.code === selectedLanguage)?.name}
              </div>
            </div>
            
            <h3 className="text-lg font-semibold mb-4">{t('howCanIHelp')}</h3>
            
            <div className="grid grid-cols-1 gap-3 mb-6">
              <button className="p-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:shadow-lg transition-all">
                üìö {t('subjectTutoring')}
              </button>
              <button className="p-4 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg hover:shadow-lg transition-all">
                üéØ {t('examPrep')}
              </button>
              <button className="p-4 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:shadow-lg transition-all">
                üíº {t('careerGuidance')}
              </button>
              <button className="p-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-lg hover:shadow-lg transition-all">
                üó£Ô∏è {t('languageLearning')}
              </button>
            </div>
            
            <button 
              onClick={handleNext}
              className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center"
            >
              {t('askQuestion')} <ArrowRight className="ml-2 w-4 h-4" />
            </button>
          </div>
        );

      case 'query':
        return (
          <div>
            <h2 className="text-xl font-bold mb-4">{t('askQuestion')}</h2>
            
            {phoneType === 'basic' ? (
              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                <div className="flex items-center">
                  <Volume2 className="w-5 h-5 text-yellow-600 mr-2" />
                  <span className="text-yellow-800 font-medium">{t('voiceModeActive')}</span>
                </div>
                <p className="text-yellow-700 text-sm mt-1">{t('speakClearly')}</p>
              </div>
            ) : (
              <div className="flex space-x-2 mb-4">
                <button 
                  onClick={() => setInputMode('type')}
                  className={`flex-1 p-2 rounded-lg ${inputMode === 'type' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'}`}
                >
                  <Type className="w-4 h-4 mx-auto mb-1" />
                  <div className="text-xs">Text</div>
                </button>
                <button 
                  onClick={() => setInputMode('select')}
                  className={`flex-1 p-2 rounded-lg ${inputMode === 'select' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'}`}
                >
                  <Volume2 className="w-4 h-4 mx-auto mb-1" />
                  <div className="text-xs">Voice</div>
                </button>
              </div>
            )}
            
            <div className="mb-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                {inputMode === 'type' ? t('typeQuestion') : 
                 phoneType === 'basic' ? 'Simulated Voice Input:' : t('selectSample')}
              </label>
              
              {inputMode === 'type' ? (
                <textarea
                  value={customQuery}
                  onChange={(e) => setCustomQuery(e.target.value)}
                  placeholder={t('typeQuestion')}
                  rows={3}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              ) : (
                <select
                  value={currentQuery}
                  onChange={(e) => setCurrentQuery(e.target.value)}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="">{t('selectSample')}</option>
                  {sampleQueries.map((query, index) => (
                    <option key={index} value={query}>{query}</option>
                  ))}
                </select>
              )}
            </div>
            
            <button 
              onClick={handleNext}
              disabled={inputMode === 'type' ? !customQuery.trim() : !currentQuery}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
            >
              {t('submitQuestion')}
            </button>
          </div>
        );

      case 'response':
        const displayQuery = inputMode === 'type' ? customQuery : currentQuery;
        return (
          <div>
            <h2 className="text-xl font-bold mb-4">{t('aiResponse')}</h2>
            
            <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
              <div className="text-sm text-gray-600 mb-2">{t('yourQuestion')}</div>
              <div className="font-medium">{displayQuery}</div>
            </div>
            
            {showTyping ? (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div className="flex items-center">
                  <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                  <span className="text-blue-700">{t('aiThinking')}</span>
                </div>
              </div>
            ) : (
              <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                <div className="flex items-center mb-2">
                  <Volume2 className="w-4 h-4 text-green-600 mr-2" />
                  <span className="text-green-800 font-medium">{t('aiResponse')}</span>
                </div>
                <p className="text-green-700">{aiResponse}</p>
              </div>
            )}
            
            <div className="flex space-x-3">
              <button 
                onClick={handleNext}
                className="flex-1 bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors"
              >
                {t('askAnother')}
              </button>
              <button 
                onClick={resetDemo}
                className="flex-1 bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700 transition-colors"
              >
                {t('startOver')}
              </button>
            </div>
          </div>
        );
    }
  };

  return (
    <div className="max-w-md mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
      {/* Header */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold">QuickLink AI</h1>
            <p className="text-blue-100">USSD Voice Assistant</p>
          </div>
          <Phone className="w-8 h-8" />
        </div>
      </div>

      {/* Progress Indicator */}
      <div className="bg-gray-100 px-6 py-2">
        <div className="text-xs text-gray-600">
          Step {currentStep === 'dial' ? '1' : 
                currentStep === 'language' ? '2' :
                currentStep === 'phoneType' ? '3' :
                currentStep === 'userCheck' ? '4' :
                currentStep === 'registration' ? '5' :
                currentStep === 'mainMenu' ? '6' :
                currentStep === 'query' ? '7' : '8'} of 8
        </div>
        <div className="w-full bg-gray-300 rounded-full h-1 mt-1">
          <div 
            className="bg-blue-600 h-1 rounded-full transition-all duration-300"
            style={{
              width: `${
                currentStep === 'dial' ? '12.5%' :
                currentStep === 'language' ? '25%' :
                currentStep === 'phoneType' ? '37.5%' :
                currentStep === 'userCheck' ? '50%' :
                currentStep === 'registration' ? '62.5%' :
                currentStep === 'mainMenu' ? '75%' :
                currentStep === 'query' ? '87.5%' : '100%'
              }`
            }}
          />
        </div>
      </div>

      {/* Content */}
      <div className="p-6">
        {renderStep()}
      </div>

      {/* Footer */}
      <div className="bg-gray-50 px-6 py-4 text-center">
        <div className="text-xs text-gray-500">
          Demo for NVP Presentation ‚Ä¢ No Internet Required
        </div>
      </div>
    </div>
  );
};

export default QuickLinkAIDemo;